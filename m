Return-Path: <netdev+bounces-16621-lists+netdev=lfdr.de@vger.kernel.org>
X-Original-To: lists+netdev@lfdr.de
Delivered-To: lists+netdev@lfdr.de
Received: from ny.mirrors.kernel.org (ny.mirrors.kernel.org [IPv6:2604:1380:45d1:ec00::1])
	by mail.lfdr.de (Postfix) with ESMTPS id 1867F74E058
	for <lists+netdev@lfdr.de>; Mon, 10 Jul 2023 23:44:50 +0200 (CEST)
Received: from smtp.subspace.kernel.org (wormhole.subspace.kernel.org [52.25.139.140])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by ny.mirrors.kernel.org (Postfix) with ESMTPS id EE8791C20BC5
	for <lists+netdev@lfdr.de>; Mon, 10 Jul 2023 21:44:48 +0000 (UTC)
Received: from localhost.localdomain (localhost.localdomain [127.0.0.1])
	by smtp.subspace.kernel.org (Postfix) with ESMTP id 9E5291640F;
	Mon, 10 Jul 2023 21:44:46 +0000 (UTC)
X-Original-To: netdev@vger.kernel.org
Received: from lindbergh.monkeyblade.net (lindbergh.monkeyblade.net [23.128.96.19])
	(using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
	(No client certificate requested)
	by smtp.subspace.kernel.org (Postfix) with ESMTPS id 92CD81640B
	for <netdev@vger.kernel.org>; Mon, 10 Jul 2023 21:44:46 +0000 (UTC)
Received: from mail-ed1-x52b.google.com (mail-ed1-x52b.google.com [IPv6:2a00:1450:4864:20::52b])
	by lindbergh.monkeyblade.net (Postfix) with ESMTPS id F0AFAF4
	for <netdev@vger.kernel.org>; Mon, 10 Jul 2023 14:44:44 -0700 (PDT)
Received: by mail-ed1-x52b.google.com with SMTP id 4fb4d7f45d1cf-51e56749750so2225664a12.0
        for <netdev@vger.kernel.org>; Mon, 10 Jul 2023 14:44:44 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=broadcom.com; s=google; t=1689025483; x=1691617483;
        h=content-transfer-encoding:cc:to:subject:message-id:date:from
         :in-reply-to:references:mime-version:from:to:cc:subject:date
         :message-id:reply-to;
        bh=7zgH4zmDWtcqeS/FRVJyRioLaC/Bp5aPUYtem3l2OZc=;
        b=bQes9shsKmSn8/GiEPvlCMvGSBpmBGvxOexRQFZpCnVZTYwhvvHdxucVEWccD7Oehk
         /k+veOJ3K6QwlAFy/+1O+DFnNUk92kzfqOhBoLRqgtUgiTNs4F6u7X47T1ep0xtyNeNS
         YpPYQkTCsuTi3Ds6Bq7CusdA0K+AjWbjWN4NE=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20221208; t=1689025483; x=1691617483;
        h=content-transfer-encoding:cc:to:subject:message-id:date:from
         :in-reply-to:references:mime-version:x-gm-message-state:from:to:cc
         :subject:date:message-id:reply-to;
        bh=7zgH4zmDWtcqeS/FRVJyRioLaC/Bp5aPUYtem3l2OZc=;
        b=lYPhsLdgPDCoPB8K0VFU1MMnMaASksqw6N+lNlQmCP2d5Ul9XQK2pyH391E+0zoH6B
         5Dpr+xvSLhWo+j/Cnf6cKEriZ8ljHRZEUSfE/WNwBsrdDLubiXRs7OelkAB0RmDofazW
         WV6DLhHApkPdyyG/bcD4Huzz9crg8RHKgPYtooLRI50MruZVfXWreydgYDaXQ9KYMyLz
         cGoey+p5OY9utVUCXjcTANoW+AIV9wVBoI+f5MDvuRTJZcXkI0q/RhHOGEGN740reqGK
         G9p9zi4Yy5zITldViOBFIXTczDsaYxr+bu3QByl9PDsQKkmDFcX2mHkQ7Eeh+Oa9R6o0
         pQTw==
X-Gm-Message-State: ABy/qLZ5aoearVN9Om/niIr/NSA0A/cZ5EoZoltLMjBEKmEqWJ4vJHre
	uQ5MQ2MRPufKt4+Muf8OY+3kQx9DP1nUXLEbEf+ZAA7z+hzALvBI
X-Google-Smtp-Source: APBJJlHf6Hl5B+5bOhkCc2qPx4+axEhB+e+o9bYktcBP+5lGJYIr7afUOQ64qjMkmjpWPxpa/ML++aKihCAKT4kQBdQ=
X-Received: by 2002:a05:6402:d3:b0:51d:9195:400f with SMTP id
 i19-20020a05640200d300b0051d9195400fmr13385415edu.17.1689025483268; Mon, 10
 Jul 2023 14:44:43 -0700 (PDT)
Precedence: bulk
X-Mailing-List: netdev@vger.kernel.org
List-Id: <netdev.vger.kernel.org>
List-Subscribe: <mailto:netdev+subscribe@vger.kernel.org>
List-Unsubscribe: <mailto:netdev+unsubscribe@vger.kernel.org>
MIME-Version: 1.0
References: <20230710205611.1198878-1-kuba@kernel.org>
In-Reply-To: <20230710205611.1198878-1-kuba@kernel.org>
From: Michael Chan <michael.chan@broadcom.com>
Date: Mon, 10 Jul 2023 14:44:31 -0700
Message-ID: <CACKFLikt=1U5fB2Xe=KfsvjfrXmgQuR2PH4iWCESWcpZBf-8Qg@mail.gmail.com>
Subject: Re: [PATCH net-next 0/3] eth: bnxt: handle invalid Tx completions
 more gracefully
To: Jakub Kicinski <kuba@kernel.org>
Cc: davem@davemloft.net, netdev@vger.kernel.org, edumazet@google.com, 
	pabeni@redhat.com
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIMWL_WL_HIGH,
	DKIM_SIGNED,DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,RCVD_IN_DNSWL_NONE,
	SPF_HELO_NONE,SPF_NONE,T_SCC_BODY_TEXT_LINE autolearn=ham
	autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
	lindbergh.monkeyblade.net

On Mon, Jul 10, 2023 at 1:56=E2=80=AFPM Jakub Kicinski <kuba@kernel.org> wr=
ote:
>
> bnxt trusts the events generated by the device which may lead to kernel
> crashes. These are extremely rare but they do happen. For a while
> I thought crashing may be intentional, because device reporting invalid
> completions should never happen, and having a core dump could be useful
> if it does. But in practice I haven't found any clues in the core dumps,
> and panic_on_warn exists.

Indeed, it was intentional to crash the kernel so that we could
analyze the rings in the core dump.  Typically, we would find a bad
completion in one of the rings and we would debug it with the hardware
team during early chip testing.  Either the bug is fixed or some
suitable workaround is implemented.  Ideally, this should never happen
once the chip goes into production.

I suppose in a large enough deployment, this NULL SKB crash can
happen.  I will review your patchset later today.  Thanks.

